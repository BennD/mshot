name: cache
description: Setup cache

inputs:
  modify_cache:
    description: 'Decides if cache should be modified or restored only'
    required: true
  path:
    description: 'Cache path'
    required: true
  key:
    description: 'Cache key'
    required: true
  restore_keys:
    description: 'Cache restore keys'
    required: false

runs:
  using: "composite"

  steps:
    # Setup cache
    - name: Setup cache
      id: setup_cache
      if: inputs.modify_cache == 'true'
      uses: actions/cache@v3
      with:
        path: ${{ inputs.path }}
        key: ${{ inputs.key }}
        restore-keys: ${{ inputs.restore_keys }}
    - uses: ./.github/actions/util/log_task
      with:
        success_message: "Setup cache"
    - uses: ./.github/actions/util/log_task
      with:
        success: ${{ steps.setup_cache.outputs.cache-hit }}
        success_message: "Restored cache"
        failure_message: "Failed to restore cache"

    # Restore cache
    - name: Restore cache
      id: restore_cache
      if: inputs.modify_cache == 'false'
      uses: actions/cache/restore@v3
      with:
        path: ${{ inputs.path }}
        key: ${{ inputs.key }}
        restore-keys: ${{ inputs.restore_keys }}
    - uses: ./.github/actions/util/log_task
      with:
        success: ${{ steps.restore_cache.outputs.cache-hit }}
        success_message: "Restored cache"
        failure_message: "Failed to restore cache"