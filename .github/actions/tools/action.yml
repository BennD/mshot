name: tools
description: Install tools

inputs:
  modify_cache:
    description: 'Installs required build tools and updates cache'
    required: true
  rust:
    description: 'Rust toolchain'
    required: true
  github_token:
    description: 'GitHub token'
    required: true

runs:
  using: "composite"

  steps:
    # Setup tool cache
    - run: echo "### Setup tool cache" >> $GITHUB_STEP_SUMMARY
    - name: Setup tool cache
      if: inputs.modify_cache == 'true'
      uses: ./.github/actions/util/cache
      with:
        path: |
          ~/.local/
        key: ${{ runner.os }}-tools
        modify_cache: ${{ inputs.modify_cache }}

    # Add ~/.local/bin to PATH
    - run : echo "### Add ~/.local/bin to PATH" >> $GITHUB_STEP_SUMMARY
    - name: Add ~/.local/bin to PATH (Linux/macOS)
      if: runner.os == 'Linux' || runner.os == 'macOS'
      run: echo "$HOME/.local/bin" >> $GITHUB_PATH
    - name: Add ~/.local/bin to PATH (Windows)
      if: runner.os == 'Windows'
      shell: powershell
      run: echo "${HOME}/.local/bin" | Out-File -FilePath $env:GITHUB_PATH -Encoding utf8 -Append

    # Install rust
    - run: echo "### Install rust ${{ inputs.rust }}" >> $GITHUB_STEP_SUMMARY
    - name: Install rust ${{ inputs.rust }}
      uses: ./.github/actions/tools/rust
      with:
        rust: ${{ inputs.rust }}
        modify_cache: ${{ inputs.modify_cache }}

    # Install protoc
    - run: echo "### Install protoc" >> $GITHUB_STEP_SUMMARY
    - name: Install protoc
      uses: ./.github/actions/tools/protoc
      with:
        github_token: ${{ inputs.github_token }}